import{d as X,I as Z,m as ss,Y as ts,j as a,l as es,ac as os,k as M,ad as O,o as c,n as r,p as s,w as ns,v as as,q as i,a4 as ls,F as S,s as C,t as o,H as j,L as U,ae as is}from"./index-4a3460b5.js";import{b as q}from"./route-block-83d24a4e.js";const ds={class:"bg-base-100 px-4 pt-3 pb-4 rounded shadow"},cs={class:"form-control"},rs={class:"input-group input-group-md w-full flex"},us={key:0,class:"text-error mt-1"},_s={key:0,class:"mt-4"},hs={class:"grid grid-cols-1 md:!grid-cols-4 auto-cols-auto gap-4 pb-4"},ps={class:"bg-base-100 px-4 py-3 rounded shadow flex justify-between items-center"},vs={class:"text-sm mb-1 flex flex-col truncate"},fs={class:"text-lg font-semibold text-main"},ms={class:"text-md"},xs={class:"avatar placeholder"},bs={class:"bg-rose-100 text-neutral-content rounded-full w-12 h-12"},gs={class:"text-2xl text-error font-semibold"},ws={class:"bg-base-100 px-4 py-3 rounded shadow flex justify-between items-center"},ys={class:"text-sm mb-1 flex flex-col truncate"},ks={class:"text-lg font-semibold text-main"},$s={class:"text-md"},Ss={class:"avatar placeholder"},Cs={class:"bg-green-100 text-neutral-content rounded-full w-12 h-12"},js={class:"text-2xl text-success font-semibold"},Ts={class:"bg-base-100 px-4 py-3 rounded shadow flex justify-between items-center"},Ls={class:"text-sm mb-1 flex flex-col truncate"},Ds={class:"text-lg font-semibold text-main"},Vs={class:"text-md"},Bs={class:"avatar placeholder"},Es={class:"bg-violet-100 text-neutral-content rounded-full w-12 h-12"},Fs={class:"text-2xl text-primary font-semibold"},Is={class:"bg-base-100 px-4 py-3 rounded shadow flex justify-between items-center"},Ns={class:"text-sm mb-1 flex flex-col truncate"},Hs={class:"text-lg font-semibold text-main"},Ps={class:"text-md"},zs={class:"avatar placeholder"},As={class:"bg-blue-100 text-neutral-content rounded-full w-12 h-12"},Ms={class:"text-2xl text-info font-semibold"},Os={key:1,class:"bg-base-100 p-4 rounded shadow"},Us={class:"flex flex-1 flex-col truncate"},qs={class:"text-sm card-title text-error mb-6"},Rs={class:"text-xs mb-1"},Ws={class:"text-xs break-words"},Ys={class:"flex flex-rows flex-wrap py-6"},Gs={class:"flex flex-rows justify-between"},Js={class:"truncate"},Ks=["data-tip"],Qs=["data-tip"],Xs=s("div",{class:"divider"},null,-1),Zs={class:"text-[#00cfe8] bg-[rgba(0,207,232,0.12)] rounded shadow mt-4 alert-info"},st={class:"drop-shadow-md px-4 pt-2 pb-2",style:{"box-shadow":"rgba(0, 207, 232, 0.4) 0px 6px 15px -7px"}},tt={class:"text-base font-semibold"},et={class:"px-4 py-4"},ot={style:{"list-style-type":"disc"},class:"pl-8"},nt=X({__name:"index",setup(at){var N,H;const R=Z(),W=ss(),T=ts(),L=a(((H=(N=W.current)==null?void 0:N.endpoints)==null?void 0:H.rpc)||[{address:"",provider:""}]);let h=a("");const Y=a(T.validators);let _=a(200),v=a(""),u=a({}),y=a(""),D=a(""),V=a(""),B=a(""),b=null,E=a(new Date),k=a([]),F=a([]);es(async()=>{F.value=await T.fetchAcitveValdiators(),h.value=L.value[0].address+"/consensus_state",await I(),g(),$(),b=setInterval(()=>{g()},6e3)}),os(()=>{$()});function $(){clearInterval(b),b=null}const G=M(()=>R.toDay(E.value,"time")),J=M(()=>F.value.map(t=>{const e=t;return e.hex=is(t.consensus_pubkey),e}));function K(t,e){var f,m,x,P;if(e==="nil-Vote"){if((m=(f=k.value)==null?void 0:f[t])!=null&&m.address){const p=J.value.find(w=>{var z,A;return w.hex===((A=(z=k.value)==null?void 0:z[t])==null?void 0:A.address)});return((x=p==null?void 0:p.description)==null?void 0:x.moniker)||t}return t}const n=e.substring(e.indexOf(":")+1,e.indexOf(" ")),d=e.split(" "),l=Y.value.find(p=>{var w;return(w=p==null?void 0:p.hex)==null?void 0:w.startsWith(n)});return`${((P=l==null?void 0:l.description)==null?void 0:P.moniker)||n} - ${d[2]}`}async function Q(){_.value=200,v.value="",u.value={},$(),await I(),g(),b=setInterval(()=>{g()},6e3)}async function I(){let t=h.value.replace("consensus_state","dump_consensus_state");try{const e=await O(t);if(!e.ok)throw new Error(`HTTP error: ${e.status}`);_.value=e.status,v.value=e.statusText;const n=await e.json();k.value=n.result.round_state.validators.validators}catch(e){_.value=(e==null?void 0:e.status)||500,v.value=(e==null?void 0:e.message)||"Error"}}async function g(){y.value="0%",E.value=new Date,_.value===200&&O(h.value).then(t=>(_.value=t.status,v.value=t.statusText,t.json())).then(t=>{var n,d,l,f;u.value=t.result.round_state;const e=(d=(n=u==null?void 0:u.value)==null?void 0:n["height/round/step"])==null?void 0:d.split("/");D.value=e[0],V.value=e[1],B.value=e[2],(f=(l=u.value)==null?void 0:l.height_vote_set)==null||f.forEach(m=>{const x=Number(m.prevotes_bit_array.substring(m.prevotes_bit_array.length-4));x>0&&(y.value=`${(x*100).toFixed()}%`)})}).catch(t=>{_.value=500,v.value=t})}return(t,e)=>(c(),r("div",null,[s("div",ds,[s("div",cs,[s("label",rs,[ns(s("select",{"onUpdate:modelValue":e[0]||(e[0]=n=>ls(h)?h.value=n:h=n),class:"select select-bordered w-full flex-1"},[(c(!0),r(S,null,C(L.value,(n,d)=>(c(),r("option",{key:d},o(n==null?void 0:n.address)+"/consensus_state ",1))),128))],512),[[as,i(h)]]),s("button",{class:"btn btn-primary",onClick:Q},o(t.$t("consensus.monitor")),1)])]),i(_)!==200?(c(),r("div",us,o(i(_))+": "+o(i(v)),1)):j("",!0)]),i(u)["height/round/step"]?(c(),r("div",_s,[s("div",hs,[s("div",ps,[s("div",vs,[s("h4",fs,o(i(y)),1),s("span",ms,o(t.$t("consensus.onboard_rate")),1)]),s("div",xs,[s("div",bs,[s("span",gs,o(t.$t("consensus.o")),1)])])]),s("div",ws,[s("div",ys,[s("h4",ks,o(i(D)),1),s("span",$s,o(t.$t("account.height")),1)]),s("div",Ss,[s("div",Cs,[s("span",js,o(t.$t("consensus.h")),1)])])]),s("div",Ts,[s("div",Ls,[s("h4",Ds,o(i(V)),1),s("span",Vs,o(t.$t("consensus.round")),1)]),s("div",Bs,[s("div",Es,[s("span",Fs,o(t.$t("consensus.r")),1)])])]),s("div",Is,[s("div",Ns,[s("h4",Hs,o(i(B)),1),s("span",Ps,o(t.$t("consensus.step")),1)]),s("div",zs,[s("div",As,[s("span",Ms,o(t.$t("consensus.s")),1)])])])])])):j("",!0),i(u)["height/round/step"]?(c(),r("div",Os,[s("div",Us,[s("h2",qs,o(t.$t("consensus.updated_at"))+" "+o(G.value||""),1),(c(!0),r(S,null,C(i(u).height_vote_set,n=>(c(),r("div",{key:n.round},[s("div",Rs,o(t.$t("consensus.round"))+": "+o(n.round),1),s("div",Ws,o(n.prevotes_bit_array),1),s("div",Ys,[(c(!0),r(S,null,C(n.prevotes,(d,l)=>(c(),r("div",{class:"w-48 rounded-3xl h-5 text-sm px-2 text-slate-200 leading-5",key:l,size:"sm",style:{margin:"2px"}},[s("span",Gs,[s("span",Js,o(K(l,"nil-Vote")),1),s("span",null,[s("span",{class:U(["tooltip",{"bg-green-400":String(d).toLowerCase()!=="nil-vote","bg-red-400":String(d).toLowerCase()==="nil-vote"}]),"data-tip":d}," ",10,Ks),s("span",{class:U(["tooltip ml-1",{"bg-green-400":String(n.precommits[l]).toLowerCase()!=="nil-vote","bg-red-400":String(n.precommits[l]).toLowerCase()==="nil-vote"}]),"data-tip":n.precommits[l]}," ",10,Qs)])])]))),128))])]))),128))]),Xs])):j("",!0),s("div",Zs,[s("div",st,[s("h2",tt,o(t.$t("consensus.tips")),1)]),s("div",et,[s("ul",ot,[s("li",null,o(t.$t("consensus.tips_description_1")),1),s("li",null,o(t.$t("consensus.tips_description_2")),1)])])])]))}});typeof q=="function"&&q(nt);export{nt as default};
